@model FinalProject.Models.Summary

@{
    ViewBag.Title = "Details";
}

@Scripts.Render("~/bundles/jquery")

<h2>Details</h2>

<div>
    <h4>Patient</h4>
    <hr />
    <dl class="dl-horizontal">

        Customer Id: @Html.DisplayFor(model => model.userID)
        Date: @Html.DisplayFor(model => model.timeStamp)
        Summary: @Html.DisplayFor(model => model.content)

        <title>Send Symptoms</title>

        <h4>The Diagnosis is:</h4>

        <html>
        <body>

            <select id="Diagnosis">
                <option value="arthritis">Arthritis</option>
                <option value="strepthroat">Strep Throat</option>
                <option value="allergy">Allergy</option>
            </select>

        </body>
    </html>

    <form action="/Doctor/Done" method="POST" name="myForm" id="myForm">
        <div class="form-horizontal">
        </div>

        <div class="form-group">
            <div class="col-md-offset-2 col-md-10">
                <input class="btn btn-default" value="Submit" type="submit">
            </div>
        </div>

</div>

        </form>
    </dl>
</div>
<p>
    @Html.ActionLink("Back to List", "Index")
</p>
<script>

        $('#myForm').submit(function (e) {

            e.preventDefault();

            var userID = '@Model.userID';
            var diagnosis = document.getElementById("Diagnosis").value;
            var token = "ABRAKADABR@1237";
            var formData = $("#myForm").serializeArray();
            var formDataObject = {};
            $.each(formData, function () {
            if (formDataObject[this.name]) {
            if (!formDataObject[this.name].push) {
            formDataObject[this.name] = [formDataObject[this.name]];
            }
            formDataObject[this.name].push(this.value || '');
            } else {
            formDataObject[this.name] = this.value || '';
            }
            });
            var postDtails = { "token": token, "userID": userID.trim(), "diagnosis": diagnosis };
            var Data = JSON.stringify(postDtails);
            

            $.ajax({
            type: "POST",
            url: "http://193.106.55.122/update",
            data: Data,
            success: function (data) {
            console.log('Submission was successful.');
            console.log(data);
            window.location.href = "/yoyag/Doctor/Done";
            },
            error: function (data) {
            console.log('An error occurred.');
            console.log(data);
            },
            dataType: "json",
            contentType: "application/json"
            });
    });
</script>